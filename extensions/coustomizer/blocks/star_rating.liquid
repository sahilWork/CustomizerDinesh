{% assign avg_rating = block.settings.product.metafields.demo.avg_rating.value | round %}
<button id="ratingButton" style="color:{{ block.settings.colour }}; background-color:{{ block.settings.bg_colour }}; width: 250px; height: 50px; cursor: pointer;">
 Customize
</button>

<div id="ratingPopup" style="display:none; border: 1px solid rgb(204, 204, 204); padding: 20px; background: rgb(255, 255, 255); position: fixed; top: 0; left: 0; transform: translate(0%, 0%); z-index: 10; width: 100%; height: 100% box-shadow: rgba(0, 0, 0, 0.2) 0px 4px 8px; border-radius: 10px; right: 0; height: 100%!important;">
 <div class="tabs-section-app">
  <div style="cursor: pointer;">
    <div id="designTab" style="flex: 1; padding: 10px; background: #f0f0f0; text-align: center; border-radius: 5px 0 0 5px;">Design</div>
    <div id="colorTab" style="flex: 1; padding: 10px; background: #fff; text-align: center; border-radius: 0 5px 5px 0;">Colors</div>
  </div>
  
  <div id="productData">
    <!-- Content will be dynamically generated -->
  </div>
  </div>
  <button id="closePopup" style="padding: 10px 20px; border: none; background-color: {{ block.settings.bg_colour }}; color: {{ block.settings.colour }}; border-radius: 5px; cursor: pointer; position: absolute; top: 10px; right: 10px;">
    Close
  </button>
</div>
<style>

#shopify-section-template--23504161636628__main .page-width {
    max-width: 100%;
    padding: 0;
}
.tabs-section-app {
  display: flex; 
  align-items: flex-start; 
  column-gap: 40px;
}

.product__info-container {
 
    margin: 0 auto;
}
.product--no-media {
   
    max-width: 100% !important;
}
</style>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script>
  $(document).ready(function() {
    $('#ratingButton').hide(); // Initially hide the button
    
    const requestOptions = {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({ /* Your request payload here */ }), 
      redirect: "follow"
    };

    fetch("https://bdab-2405-201-5004-7835-5147-5a3d-4792-f0cb.ngrok-free.app/api/frontendgetpro", requestOptions)
      .then((response) => response.json())
      .then((result) => {
        const lastUrlSegment = window.location.pathname.split('/').pop(); 
        const productTitles = result.products.map(product => product.title); 
        const isMatch = productTitles.includes(lastUrlSegment);

        if (isMatch) {
          $('#ratingButton').show(); // Show the button
        } else {
          $('#ratingButton').hide(); // Hide the button
        }

        const productDataDiv = $('#productData');
        productDataDiv.empty(); // Clear previous content

        let designs = '';
        let colors = '';

      result.products.forEach(product => {
          if (product.title.toLowerCase() === lastUrlSegment.toLowerCase()) {
              const designs = product.designs || 'N/A';
              const colors = product.colors || 'N/A';
              
              // Splitting the designs and colors by commas
              const designArray = designs.split(',').map(design => design.trim());
              const colorArray = colors.split(',').map(color => color.trim());
              
              // Creating the HTML for designs and colors
              const designHtml = designArray.map(design => `<p>${design}</p>`).join('');
              const colorHtml = colorArray.map(color => `<p>${color}</p>`).join('');
              
              productDataDiv.append(`
                  <div id="designContent" class="tabContent">
                      <h4 style="margin: 0px;">${product.title}</h4>
                      <p>Design:</p>
                      ${designHtml}
                  </div>
                  <div id="colorContent" class="tabContent" style="display: none;">
                      <h4>${product.title}</h4>
                      <p>Color:</p>
                      ${colorHtml}
                  </div>
              `);
          }
      });


      })
      .catch((error) => console.error(error));
    
    $('#ratingButton').on('click', function() {
      $('#ratingPopup').show(); // Show the popup
    });

    $('#closePopup').on('click', function() {
      $('#ratingPopup').hide(); // Hide the popup
    });

    $('#designTab').on('click', function() {
      $('#designContent').show();
      $('#colorContent').hide();
      $(this).css('background', '#f0f0f0');
      $('#colorTab').css('background', '#fff');
    });

    $('#colorTab').on('click', function() {
      $('#designContent').hide();
      $('#colorContent').show();
      $(this).css('background', '#f0f0f0');
      $('#designTab').css('background', '#fff');
    });
  });
</script>

{% schema %}
{
  "name": "Star Rating Button",
  "target": "section",
  "settings": [
    { "type": "color", "id": "colour", "label": "Text Color", "default": "#ff0000" },
    { "type": "color", "id": "bg_colour", "label": "Background Color", "default": "#ffffff" }
  ]
}
{% endschema %}
